<html>

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/css/base.css">
    <link type="text/css" rel="stylesheet" href="/css/materialize.min.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="/css/docs.css" />
    <link rel="icon" href="../imgs/logos/botguy.png">

    <title>Botball Documentation - Tutorial</title>

    <meta name="theme-color" content="#00796b">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="/js/materialize.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.button-collapse').sideNav({
                draggable: true
            });
        $(".active").parent().parent().siblings()[0].click() })
    </script>

    <header>
        <ul id="slide-out" class="side-nav fixed">
            <li style="height: 130px" class="red lighten-1">
                <div class="userView">
                    <h5 class="white-text"><a href="/docs/index.html" class="white-text">Index</a></h5>
                </div>
            </li>
            <li><a href="/docs/tutorial.html">Tutorial</a></li>
            <li class="no-padding">
                <ul class="collapsible collapsible-accordion">
                    <li>
                        <a class="collapsible-header"><i class="material-icons">arrow_drop_down</i>Data Objects</a>
                        <div class="collapsible-body" style="display: block">
                            <ul>
                                <li><a href="/docs/data-objects/index.html">Introduction</a></li>
                                <li><a href="/docs/data-objects/variables.html">Variables</a></li>
                                <li><a href="/docs/data-objects/constants.html">Constants</a></li>
                                <li><a href="/docs/data-objects/data-types.html">Data Types</a></li>
                                <li><a href="/docs/data-objects/arrays.html">Arrays</a></li>
                                <li><a href="/docs/data-objects/structures.html">Structures</a></li>
                                <li><a href="/docs/data-objects/initialization-examples.html">Initialization Examples</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="collapsible-header"><i class="material-icons">arrow_drop_down</i>Statements and Expressions</a>
                        <div class="collapsible-body" style="display: block">
                            <ul>
                                <li><a href="/docs/statements-and-expressions/index.html">Introduction</a></li>
                                <li><a href="/docs/statements-and-expressions/operators.html">Operators</a></li>
                                <li><a href="/docs/statements-and-expressions/control-flow.html">Control Flow</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li><a href="/docs/tutorial.html">Style</a></li>
            <li><a href="/docs/tutorial.html">Debugging</a></li>
            <li class="no-padding">
                <ul class="collapsible collapsible-accordion">
                    <li>
                        <a class="collapsible-header"><i class="material-icons">arrow_drop_down</i>Printing</a>
                        <div class="collapsible-body" style="display: block">
                            <ul>
                                <li><a href="/docs/printing/index.html">Introduction</a></li>
                                <li><a href="/docs/printing/examples.html">Examples</a></li>
                                <li><a href="/docs/printing/printf-codes.html">printf Codes</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
                <ul class="collapsible collapsible-accordion">
                    <li>
                        <a class="collapsible-header"><i class="material-icons">arrow_drop_down</i>Preprocessor</a>
                        <div class="collapsible-body" style="display: block">
                            <ul>
                                <li><a href="/docs/preprocessor/index.html">Introduction</a></li>
                                <li><a href="/docs/preprocessor/directives.html">Directives</a></li>
                                <li><a href="/docs/preprocessor/include.html">Include</a></li>
                                <li><a href="/docs/preprocessor/macros.html">Macros</a></li>
                                <li><a href="/docs/preprocessor/conditional-compilation.html">Conditional Compilation</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li><a href="/docs/lib/math.html">Math Library</a></li>
            <li class="no-padding">
                <ul class="collapsible collapsible-accordion">
                    <li>
                        <a class="collapsible-header"><i class="material-icons">arrow_drop_down</i>KIPR Wallaby/Link</a>
                        <div class="collapsible-body" style="display: block">
                            <ul>
                                <li><a href="/docs/lib/kipr/common-functions.html">Common Functions</a></li>
                                <li><a href="/docs/lib/kipr/functions.html">Functions List</a></li>
                                <li><a href="/docs/lib/kipr/camera.html">Camera Functions</a></li>
                                <li><a href="/docs/lib/kipr/graphics.html">Graphics Functions</a></li>
                                <li class="active"><a href="/docs/lib/kipr/depth.html">Depth Sensor Functions</a></li>
                                <li><a href="/docs/lib/kipr/usb.html">File I/O Functions</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
                <ul class="collapsible collapsible-accordion">
                    <li>
                        <a class="collapsible-header"><i class="material-icons">arrow_drop_down</i>iRobot Create</a>
                        <div class="collapsible-body" style="display: block">
                            <ul>
                                <li><a href="/docs/lib/kipr/create/index.html">Introduction</a></li>
                                <li><a href="/docs/lib/kipr/create/serial.html">Serial Functions</a></li>
                                <li><a href="/docs/lib/kipr/create/configuration.html">Configuration Functions</a></li>
                                <li><a href="/docs/lib/kipr/create/movement.html">Movement Functions</a></li>
                                <li><a href="/docs/lib/kipr/create/sensors.html">Sensor Functions</a></li>
                                <li><a href="/docs/lib/kipr/create/battery.html">Battery Functions</a></li>
                                <li><a href="/docs/lib/kipr/create/built-ins.html">Built-In Functions</a></li>
                                <li><a href="/docs/lib/kipr/create/music-leds.html">LED and Music Functions</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li><a href="/docs/lib/kipr/botball.html">Botball Functions</a></li>
            <li><a href="/docs/lib/kipr/threads.html">Threads</a></li>
            <li class="no-padding">
                <ul class="collapsible collapsible-accordion">
                    <li>
                        <a class="collapsible-header"><i class="material-icons">arrow_drop_down</i>Motors and Sensors</a>
                        <div class="collapsible-body" style="display: block">
                            <ul>
                                <li><a href="/docs/lib/kipr/info/digital-analog-sensors.html">Analog and Digital Sensors</a></li>
                                <li><a href="/docs/lib/kipr/info/usb-sensors.html">USB Sensors</a></li>
                                <li><a href="/docs/lib/kipr/info/motors-servos.html">Motors and Servos</a></li>
                                <li><a href="/docs/lib/kipr/info/simulator.html">Simulator</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li><a href="/docs/full.html">Full Documentation</a></li>
        </ul>
        <nav class="nav-extended red lighten-2">
            <div class="nav-wrapper">
                <div class="col s12">
                    <a href="#" data-activates="slide-out" class="button-collapse" style="font-size: 50px"><i class="material-icons">menu</i></a>
                    <a href="/docs/index.html" class="brand-logo waves-effect" id="top">Botball Documentation</a>
                </div>
            </div>
            <div class="nav-wrapper">
                <div class="col s12">
                    <a href="#!" class="breadcrumb">KIPR Wallaby/Link</a>
                    <a href="#!" class="breadcrumb">Depth Sensor Functions</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="row">

        <div class="container col s12">
            <!-- END HEADER -->

            <!--Xtion API-->

            <a name="DepthSensor"></a>
            <h3>KIPR Robot Controller Depth Functions</h3>

            <table class="centerTable">
                <tbody>
                    <tr>
                        <td>The KIPR Robot Controller has functions supporting the use of an ASUS Xtion as a USB depth sensor.
                        </td>
                        <td width="50%">
                            <!--<img class="right" src="images/XtionDepth.gif" width="50%"></img>--><br>
                        </td>
                    </tr>
                </tbody>
            </table>

            <p>The USB depth sensor provides the KIPR Robot Controller with a 240&times;320 row,column (2-dimensional) image
                of the space in front of it (rows measured down from the upper left corner of the image and columns to the
                right). The depth functions provide information about the three dimensional space in front of the Xtion,
                where the space is organized in (x,y,z) coordinates with the x-axis directed right, the y-axis is directed
                up, and the z-axis directed straight out from the Xtion. Coordinate (0,0,0) is the center of the Xtion face.
                Coordinate values are given in millimeters (mm). The depth sensor's effective range is from about 1/2 meter
                to 5 meters.</p>

            <table class="centerTable">
                <tbody>
                    <tr>
                        <td>
                            <!--<img class="center" src="images/XtionDepthView.jpg" width="80%"></img>-->
                        </td>
                    </tr>
                </tbody>
            </table>
            <br>
            <table>
                <tbody>
                    <tr>
                        <td><a name="depth_open"></a></td>
                        <td><code>depth_open </code> [Category: Depth]
                            <dl>
                                <dd>
                                    Format: <code><font class="CVariable">int</font> depth_open();</code><br> Turns on the
                                    depth sensor. Returns 1 on success, 0 on failure. See also
                                    <code>depth_close</code>.</dd>
                            </dl>
                        </td>
                    </tr>
                    <tr>
                        <td><a name="depth_close"></a></td>
                        <td><code>depth_close </code> [Category: Depth]
                            <dl>
                                <dd>
                                    Format: <code><font class="CVariable">void</font> depth_close();</code><br> Clean up
                                    the depth instance and power down the sensor. See also <code>depth_open</code>.</dd>
                            </dl>
                        </td>
                    </tr>
                    <tr>
                        <td><a name="depth_update"></a></td>
                        <td><code>depth_update </code> [Category: Depth]
                            <dl>
                                <dd>
                                    Format: <code><font class="CVariable">int</font> depth_update();</code><br> Generates
                                    a new image from the depth sensor for use by the depth functions. Returns 1 on success,
                                    0 on failure.</dd>
                            </dl>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <a name="depth_scanline_update" </a></td>
                        <td><code>depth_scanline_update </code> [Category: Depth]
                            <dl>
                                <dd>
                                    Format: <code><font class="CVariable">int</font> depth_scanline_update(<font class="CVariable">int</font> row);</code><br>                                    Replaces the current scanline information with the scanline information for the specified
                                    row of the image. Returns 1 on success, 0 on failure.
                                    <tr>
                                        <tr>
                                            <td><a name="get_depth_value"></a></td>
                                            <td><code>get_depth_value </code> [Category: Depth]
                                                <dl>
                                                    <dd>
                                                        Format: <code><font class="CVariable">int</font> get_depth_value(<font class="CVariable">int</font> row, <font class="CVariable">int</font> col);</code><br>                                                        Returns the value of the depth coordinate z in mm for row and column
                                                        positions of the image. See also <code>get_depth_world_point</code>.</dd>
                                                </dl>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a name="get_depth_world_point"></a></td>
                                            <td><code>get_depth_world_point </code> [Category: Depth]
                                                <dl>
                                                    <dd>
                                                        Format: <code>point3 get_depth_world_point(<font class="CVariable">int</font> row, <font class="CVariable">int</font> col);</code><br>                                                        Returns an object of type <code>point3</code> giving the (x,y,z)
                                                        coordinates for the object at position (row,col) in the current image.
                                                        For <br>
                                                        <div class=Indent><code> point3 p3;<br>
               p3 = get_depth_world_point(4,7);
          </code></div>
                                                        the (x,y,z) coordinates for row 4, column 7 in the image are given by <code>p3.x</code>,
                                                        <code>p3.y</code>, <code>p3.z</code>. The value returned by <code>get_depth_value</code>                                                        is the same as <code>p3.z</code>. </dd>
                                                </dl>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a name="get_depth_world_point_x"></a></td>
                                            <td><code>get_depth_world_point_x </code> [Category: Depth]
                                                <dl>
                                                    <dd>
                                                        Format: <code><font class="CVariable">int</font> get_depth_world_point_x(<font class="CVariable">int</font> row, <font class="CVariable">int</font> col);</code><br>                                                        Returns the x coordinate for the object at position (row,col) in
                                                        the current image. See also <code>get_depth_world_point</code>.
                                                    </dd>
                                                </dl>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a name="get_depth_world_point_y"></a></td>
                                            <td><code>get_depth_world_point_y </code> [Category: Depth]
                                                <dl>
                                                    <dd>
                                                        Format: <code><font class="CVariable">int</font> get_depth_world_point_y(<font class="CVariable">int</font> row, <font class="CVariable">int</font> col);</code><br>                                                        Returns the y coordinate for the object at position (row,col) in
                                                        the current image. See also <code>get_depth_world_point</code>.
                                                    </dd>
                                                </dl>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a name="get_depth_world_point_z"></a></td>
                                            <td><code>get_depth_world_point_z </code> [Category: Depth]
                                                <dl>
                                                    <dd>
                                                        Format: <code><font class="CVariable">int</font> get_depth_world__zpoint(<font class="CVariable">int</font> row, <font class="CVariable">int</font> col);</code><br>                                                        Returns the z coordinate for the object at position (row,col) in
                                                        the current image. The return value is the same as the value returned
                                                        by <code>get_depth_value</code>. See also <code>get_depth_world_point</code>.
                                                    </dd>
                                                </dl>
                                            </td>
                                        </tr>
                                        <td>
                                            <a name="get_depth_scanline_object_count" </a></td>
                                        <td><code>get_depth_scanline_object_count </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_scanline_object_count();</code><br>                                                    Returns the number of objects detected on the scanline, where an object
                                                    is detected by not having a depth break in scanning across it. This means
                                                    that if the scanline crosses a cavity, it will report two objects. Objects
                                                    are numbered starting from 0, ordered from nearest to farthest. By default,
                                                    the closest pixel for each object is used to determine how near it is.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_nearest_x" </a></td>
                                        <td><code>get_depth_scanline_object_nearest_x </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_nearest_x(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the farthest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_nearest_y" </a></td>
                                        <td><code>get_depth_scanline_object_nearest_y </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_nearest_y(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the farthest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_nearest_z" </a></td>
                                        <td><code>get_depth_scanline_object_nearest_z </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_nearest_z(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the nearest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_center_x" </a></td>
                                        <td><code>get_depth_scanline_object_center_x </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_center_x(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the farthest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_center_y" </a></td>
                                        <td><code>get_depth_scanline_object_center_y </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_center_y(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the farthest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_center_z" </a></td>
                                        <td><code>get_depth_scanline_object_center_z </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_center_z(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the center
                                                    pixel.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_farthest_x" </a></td>
                                        <td><code>get_depth_scanline_object_farthest_x </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_farthest_x(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the farthest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_farthest_y" </a></td>
                                        <td><code>get_depth_scanline_object_farthest_y </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_farthest_y(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the farthest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_farthest_z" </a></td>
                                        <td><code>get_depth_scanline_object_farthest_z </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_farthest_z(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the coordinate value for the farthest
                                                    pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_size" </a></td>
                                        <td><code>get_depth_scanline_object_size </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_size(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the distance on the scanline between
                                                    the leftmost and rightmost pixel detected.
                                            </dl>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a name="get_depth_scanline_object_angle" </a></td>
                                        <td><code>get_depth_scanline_object_angle </code> [Category: Depth]
                                            <dl>
                                                <dd>
                                                    Format: <code><font class="CVariable">int</font> get_depth_object_angle(<font class="CVariable">int</font> obj);</code><br>                                                    For the specified object returns the angular measure (in degrees) from
                                                    the leftmost pixel on the scanline to the right most. Positive is counterclockwise.
                                            </dl>
                                        </td>
                                    </tr>
                </tbody>
            </table>

            <div class="Indent">
                <h4>Example program for using a depth sensor and a graphical representation to find the distance to an object</h4>

                <a name="PointDistance"></a>
                <pre><code><font class="CVariable">int</font> main()
{
   <font class="CVariable">int</font> r, g, b, row, col, val;
   depth_open();<font class="Comment"> // initiate depth sensor</font>
   graphics_open(320,240);<font class="Comment"> // open up graphics window (full screen on KIPR Robot Controller)</font>
   <font class="CVariable">while</font>(!get_mouse_left_button()) { <font class="Comment">// loop until mouse is clicked (screen is tapped)</font>
      depth_update();<font class="Comment"> // get a new depth image</font>
      <font class="CVariable">for</font>(row=0; row<240; row++) {<font class="Comment"> // loop through rows</font>
         <font class="CVariable">for</font>(col=0; col<320; col++) {<font class="Comment"> // loop through columns in current row</font>
            val = get_depth_value(row,col) ;<font class="Comment"> // get distance for pixel in mm</font>
            <font class="CVariable">if</font>(val == 0) <font class="Comment"> // if too close or not a valid value, don't color</font>
               <font class="CVariable">continue</font>;
            <font class="CVariable">else if</font> (val > 1530) {<font class="Comment"> // if more than 1.53m away color in gray scale</font>
               val = (5000-val)/20;<font class="Comment"> // range is from 173 on down (towards darker)</font>
               graphics_pixel(col,row,val,val,val);<font class="Comment"> // paint using r=g=b (gray scale)</font>
            }
            <font class="CVariable">else</font><font class="Comment"> { // and otherwise ... </font>
               val=val > 510 ? val-510 : 0;<font class="Comment"> // rerange the distance inward by 510mm</font>
               r=val > 510 ? 0 : 255-val/2; <font class="Comment"> // increase red for closer</font>
               g=val > 510 ? 255-(val-510)/2 : val/2; <font class="Comment">// greenish for mid values</font>
               b=val > 510 ? val/2-255 : 0; <font class="Comment"> // increase blue for farther</font>
               graphics_pixel(col,row, r,g,b);<font class="Comment"> // draw the pixel</font>
            }
         }
      }
      graphics_update();<font class="Comment"> // paint the screen using the new pixel valuess</font>
   }
   get_mouse_position(&col,&row);<font class="Comment"> // where was screen tapped?</font>
   depth_close(); graphics_close(); <font class="Comment"> //close sensor and graphics window</font>
   <font class="Comment"> // Display the distance (z coordinate) to the pixels's point in space</font>
   printf(<font class="Quote">"Distance to pixel %i,%i is %imm\n\n\n"</font>,col,row,get_depth_value(row,col));
}
</code></pre>
            </div>

            <!-- START FOOTER -->
        </div>
    </main>
</body>

</html>